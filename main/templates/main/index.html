{% extends "base.html" %}
{% block title %}
Your Homepage
{% endblock %}

{% block footer %}
<script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<div class="container-fluid">
    <nav>
        <h1>Welcome to Finance</h1>
    </nav>

    <h2>Hi {{ user.username }}</h2>

    <div>
        <button id="download-csv" class="btn btn-primary">Download CSV</button>
        <button id="download-xlsx" class="btn btn-primary">Download XLSX</button>
        <a class="btn btn-primary" href="{% url 'main:recommendation-create' %}" role="button">Add new entry</a>
        <button id="select-all" class="btn btn-primary">Select all</button>
        <button id="deselect-all" class="btn btn-primary">Deselect all</button>
    </div>
    {% csrf_token %}

    <div id="example-table"></div>

    {% for rec in recommendations %}
        <table class="table">
            <thead>
                <tr>
                <th scope="col">ID in Table</th>
                <th scope="col">Edit</th>
                <th scope="col">Your Name</th>
                <th scope="col">Starting Date</th>
                <th scope="col">Ending Date</th>
                <th scope="col">Time Horizon</th>
                <th scope="col">Positioning</th>
                <th scope="col">Position</th>
                <th scope="col">Outperformance</th>
                <th scope="col">BBG Ticker 1</th>
                <th scope="col">BBG Ticker 2</th>
                <th scope="col">Pitch</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row">1</th>
                        <td>Mark</td>
                    </tr>
                <tr>
                    <th scope="row">2</th>
                        <td><a class="btn btn-primary" href="{% url 'main:recommendation-edit' %}" role="button">Edit</a></td>
                    </th>
                <tr>
                    <th scope="row">3</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">4</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">5</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">6</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">7</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">8</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">9</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">10</th>
                        <td>@twitter</td>
                    </th>
                </tr>
                <tr>
                    <th scope="row">11</th>
                        <td>@twitter</td>
                    </th>
                </tr>
            </tbody>
        </table>
    {% endfor %}

<script type="text/javascript">
    var printIcon = function(cell, formatterParams, onRendered){ //plain text value
        return "<i class='fa fa-edit'></i>";
    };
    var table = new Tabulator("#example-table", {
        height:'100%',
        ajaxURL:"./api/recommendation/",
        ajaxConfig:{
            method:"GET",
            headers: {
                "Authorization": 'Token 6b5afc0c48ad9ee364fe9be0861aa310d21c746e', // big todo how to fetch data via django rest api
            },
        },
        clipboard:true,
        selectable:true, //make rows selectable
        clipboardPasteAction:"replace",
        responsiveLayout:"hide",
        addRowPos: "top",
        layout:"fitColumns",
        columns:[
            {title:"ID in Table", field:"id", hozAlign:"center", editor:false},
            {formatter: printIcon, title: "Edit", align:"center", cellClick:function(e, cell){alert("Printing row data for: " + cell.getData().id)}},
            {title:"Your Name", field:"user", align:"center",editor:false, responsive:3},
            {title:"Starting Date", field:"starting_date", editor:false},
            {title:"Ending Date", field:"ending_date", editor:false},
            {title:"Time Horizon", field:"time_horizon",editor:false},
            {title:"Positioning", field:"positioning", align:"center",editor:false},
            {title:"Position", field:"position", align:"center",editor:false},
            {title:"Outperformance", field:"outperformance", align:"center",editor:false},
            {title:"BBG Ticker 1", field:"bloomberg_ticker_1", align:"center",editor:false},
            {title:"BBG Ticker 2 (for Pair Trade)", field:"bloomberg_ticker_2", align:"center",editor:false, responsive:2}, // hide this column first
            {title:"Pitch", field:"description", align:"center",editor:false},
        ]
    });

    document.getElementById("download-csv").addEventListener("click", function(){
        table.download("csv", "data.csv");
    });
    document.getElementById("download-xlsx").addEventListener("click", function(){
        table.download("xlsx", "data.xlsx", {sheetName:"My Index Data"});
    });
    document.getElementById("select-all").addEventListener("click", function(){
        table.selectRow();
    });
    document.getElementById("deselect-all").addEventListener("click", function(){
        table.deselectRow();
    });
</script>

</div>
{% else %}

{% endif %}

{% endblock %}
