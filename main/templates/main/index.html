{% extends "base.html" %}

{% block footer %}
<script type="text/javascript" src="https://oss.sheetjs.com/sheetjs/xlsx.full.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <nav>
        <h1>Welcome to Finance</h1>
    </nav>
    <h1>Hello World!</h1>

    <div>
        <button id="download-csv">Download CSV</button>
        <button id="download-xlsx">Download XLSX</button>
        <button id="add-row">Add Blank Row to the bottom</button>
        <button id="select-all">Select all</button>
        <button id="deselect-all">Deselect all</button>
        <button id="save" class="justify-content-end">Save and Submit</button>
    </div>
    <div id="example-table"></div>

<script type="text/javascript">
    var table = new Tabulator("#example-table", {
        height:'100%',
        ajaxURL:"./api/recommendation/",
        ajaxConfig:{
            method:"GET",
            headers: {
                "Authorization": 'Token 6e9e2fc75444377bb5a7078179b391118cbb92db', //set specific content type
            },
        },
        clipboard:true,
        selectable:true, //make rows selectable
        clipboardPasteAction:"replace",
        responsiveLayout:"hide",
        addRowPos: "top",
        layout:"fitDataStretch",
        columns:[
            {formatter:"rownum", hozAlign:"center", width:40},
            {title:"Starting Date", field:"starting_date", width:150, editor:true},
            {title:"Ending Date", field:"ending_date", editor:true},
            {title:"Time Horizon", field:"time_horizon",editor:true},
            {title:"Positioning", field:"positioning", align:"center",editor:true},
            {title:"Position", field:"position", align:"center",editor:true},
            {title:"Outperformance", field:"outperformance", align:"center",editor:true},
            {title:"BBG Ticker 1", field:"bloomberg_ticker_1", align:"center",editor:true},
            {title:"BBG Ticker 2 (for Pair Trade)", field:"bloomberg_ticker_2", align:"center",editor:true, responsive:2}, // hide this column first
            {title:"Pitch", field:"description", align:"center",editor:true},
            {title:"Analyst's Name", field:"user", align:"center",editor:false},
        ]
    });
    document.getElementById("add-row").addEventListener("click", function(){
        table.addRow({});
    });
    //trigger download of data.csv file
    document.getElementById("download-csv").addEventListener("click", function(){
        table.download("csv", "data.csv");
    });
    //trigger download of data.xlsx file
    document.getElementById("download-xlsx").addEventListener("click", function(){
        table.download("xlsx", "data.xlsx", {sheetName:"My Data"});
    });
    document.getElementById("select-all").addEventListener("click", function(){
        table.selectRow();
    });
    //deselect row on "deselect all" button click
    document.getElementById("deselect-all").addEventListener("click", function(){
        table.deselectRow();
    });
    document.getElementById("save").addEventListener("click", function(){
        var updatedData = table.getData();
        $.ajax({
            contentType : 'application/json',
            type : 'PATCH',
            dataType: 'json'
            url: "./api/recommendation/",
            data: JSON.stringify(updatedData),
        })
        .done(function( msg ) {
            alert( "Data Saved: " + msg );
        });
    });
</script>

</div>
{% endblock %}
